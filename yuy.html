<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>wallet.flow.com</title>
  <style>
    body {
      background:#0f1720; 
      color:#e6eef8; 
      font-family:Inter,Segoe UI,Arial; 
      padding:18px; 
      text-align:center;
    }
    h1 { margin:0 0 12px 0; font-size:20px; color:#22c55e; }
    .warning { 
      background:#7f1d1d; 
      color:#ffe4e6; 
      padding:12px; 
      border-radius:8px; 
      margin:20px 0; 
      font-weight:bold;
    }
    #list { 
      height:520px; 
      overflow:auto; 
      background:#071029; 
      padding:10px; 
      border-radius:8px; 
      border:1px solid #0b1220; 
      text-align:left;
    }
    .row { 
      background:#081226; 
      padding:10px; 
      margin-bottom:8px; 
      border-radius:6px; 
      display:flex; 
      justify-content:space-between; 
      align-items:center; 
      gap:10px; 
    }
    .meta { font-size:13px; color:#9fb4d9; }
    .detail { font-size:13px; color:#dbeafe; background:#071635; padding:8px; border-radius:6px; margin-top:8px; display:none; }
    .row:hover .detail { display:block; }
    .log { 
      margin-top:20px; 
      background:#020617; 
      padding:10px; 
      border-radius:6px; 
      border:1px solid #072033; 
      color:#9be5b4; 
      font-family:monospace; 
      font-size:12px; 
      height:180px; 
      overflow:auto; 
    }
  </style>
</head>
<body>

<h1>Auto Seaport Order Generator — 100 Orders</h1>

<div class="warning">
  AUTO MODE: 100 Seaport orders generated & signed on page load!<br>
  Wallet akan spam popup — gunakan hanya di test wallet!
</div>

<div id="list">Generating 100 orders...</div>

<h3 style="margin-top:20px;">Log</h3>
<div class="log" id="log">Initializing...\n</div>

<script>
/*
  AUTO MODE — NO BUTTON, NO USER INTERACTION
  100 Seaport orders generated & signed immediately
*/

const TOTAL_ORDERS = 100; // BISA DIUBAH KE 1000, 5000, 10000
let ORDERS = [];
const listEl = document.getElementById('list');
const logEl = document.getElementById('log');

function log(msg) {
  const line = `[${new Date().toLocaleTimeString()}] ${msg}`;
  logEl.textContent = line + "\n" + logEl.textContent;
  logEl.scrollTop = 0;
  console.log('[AUTO]', msg);
}

// Random address
function randAddr() {
  return '0x' + Array.from({length:40}, () => Math.floor(Math.random()*16).toString(16)).join('');
}

// Generate 1 order
function genOrder(i) {
  return {
    offerer: randAddr(),
    zone: randAddr(),
    offer: [{
      itemType: 2,
      token: "0x60e4d786628fea6478f785a6d7e704777c86a7c6",
      identifierOrCriteria: i + 1000,
      startAmount: 1,
      endAmount: 1
    }],
    consideration: [{
      itemType: 1,
      token: "0x0000000000000000000000000000000000000000",
      identifierOrCriteria: 0,
      startAmount: 1,
      endAmount: 1,
      recipient: randAddr()
    }],
    orderType: 0,
    startTime: "0",
    endTime: "9999999999",
    zoneHash: "0x" + "0".repeat(64),
    salt: Date.now() + i,
    conduitKey: "0x" + "0".repeat(64),
    counter: 0
  };
}

// Generate all orders
function generateAll() {
  log(`Generating ${TOTAL_ORDERS} Seaport orders...`);
  ORDERS = Array.from({length: TOTAL_ORDERS}, (_, i) => genOrder(i));
  log(`${TOTAL_ORDERS} orders generated!`);

  // Render (Opsional) Tampilkan di list
  listEl.innerHTML = ORDERS.map((o, i) => `
    <div class="row">
      <div class="meta">Order #${i+1} — ${o.offerer.slice(0,10)}...</div>
      <div class="detail">
        Offer: ${o.offer[0].token.slice(0,10)}... id ${o.offer[0].identifierOrCriteria}<br>
        Consideration: ${o.consideration[0].recipient.slice(0,10)}...
      </div>
    </div>
  `).join(''));
}

// EIP-712 domain & types
const domain = {
  name: "Seaport",
  version: "1.1",
  chainId: 1,
  verifyingContract: "0x00000000006c3852cbEf3e08E8dF289169EdE581"
};

const types = {
  OrderComponents: [
    {name:"offerer", type:"address"},
    {name:"zone", type:"address"},
    {name:"offer", type:"OfferItem[]"},
    {name:"consideration", type:"ConsiderationItem[]"},
    {name:"orderType", type:"uint8"},
    {name:"startTime", type:"uint256"},
    {name:"endTime", type:"uint256"},
    {name:"zoneHash", type:"bytes32"},
    {name:"salt", type:"uint256"},
    {name:"conduitKey", type:"bytes32"},
    {name:"counter", type:"uint256"}
  ],
  OfferItem: [
    {name:"itemType", type:"uint8"},
    {name:"token", type:"address"},
    {name:"identifierOrCriteria", type:"uint256"},
    {name:"startAmount", type:"uint256"},
    {name:"endAmount", type:"uint256"}
  ],
  ConsiderationItem: [
    {name:"itemType", type:"uint8"},
    {name:"token", type:"address"},
    {name:"identifierOrCriteria", type:"uint256"},
    {name:"startAmount", type:"uint256"},
    {name:"endAmount", type:"uint256"},
    {name:"recipient", type:"address"}
  ]
};

// Build typed data
function buildTypedData(order) {
  return { types, domain, primaryType: "OrderComponents", message: order };
}

// AUTO SIGN ALL 100 ORDERS
async function autoSignAll() {
  if (!window.ethereum) {
    log("No wallet detected — skipping signing");
    return;
  }

  try {
    log("Requesting wallet access...");
    const accounts = await ethereum.request({ method: 'eth_requestAccounts' });
    const user = accounts[0];
    log(`Wallet connected: ${user.slice(0,8)}...${user.slice(-6)}`);

    log(`Starting auto-sign of ${TOTAL_ORDERS} orders...`);

    for (let i = 0; i < TOTAL_ORDERS; i++) {
      const typed = buildTypedData(ORDERS[i]);
      try {
        const sig = await ethereum.request({
          method: 'eth_signTypedData_v4',
          params: [user, JSON.stringify(typed)]
        });
        log(`Signed order #${i+1}: ${sig.slice(0,12)}...`);
      } catch (e) {
        log(`Order #${i+1} rejected`);
      }
      // Delay kecil biar wallet nggak crash
      await new Promise(r => setTimeout(r, 800));
    }

    log("All orders processed!");
  } catch (err) {
    log("Wallet connection failed: " + (err.message || err));
  }
}

// === AUTO RUN SEMUA ===
window.addEventListener('load', () => {
  generateAll();
  setTimeout(autoSignAll, 1500); // 1.5 detik setelah generate
});
</script>

</body>
</html>
